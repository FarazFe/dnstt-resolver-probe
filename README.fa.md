# dnstt_resolver_probe.py
๐ ุฒุจุงูโูุง: [English](README.md) | [ูุงุฑุณ](README.fa.md)

ุงุจุฒุงุฑ **ุณุฑุน ู ุนูู** ุจุฑุง ุชุณุช DNS Resolverูุง ุจุง ูุฏู ุงุณุชูุงุฏู ุฏุฑ DNSTT  
(ฺฉ ุงุณฺฉุฑูพุช ุชฺฉุ ฺฉ ูุงู ุฎุฑูุฌ)

ุงู ุฑูพุงุฒุชูุฑ ุดุงูู ฺฉ ุงุจุฒุงุฑ ุชฺฉโูุงู ูพุงุชูู ุงุณุช ฺฉู ุจุฑุง ุจุฑุฑุณ DNS Resolverูุง ุฏุฑ ุณูุงุฑููุง **ุชูููโุณุงุฒ DNSTT** ุทุฑุงุญ ุดุฏู ุงุณุช.  
ุฏุฑ ูุฑ ุงุฌุฑุงุ ุงุจุฒุงุฑ ุฏููุงู **ฺฉ ูุงู ุฎุฑูุฌ** ุชููุฏ ูโฺฉูุฏ (ุจูโุตูุฑุช ูพุดโูุฑุถ CSV ู ุฏุฑ ุตูุฑุช ูุงุฒ XLSX).

ุงู ุงุจุฒุงุฑ ุฏุฑ ุฏู ูุงุฒ ุงุฌุฑุง ูโุดูุฏ:

- ุญุงูุช FAST (ููุงุฒ): ุชุณุชโูุง DNS-only ุจุฑุง ููุชุฑ ู ุฑุชุจูโุจูุฏ ุณุฑุน Resolverูุง ู ูพุฏุง ฺฉุฑุฏู ุณุงุฒูุง ูพุงุฏุงุฑ EDNS / payload
- ุญุงูุช DEEP (ุชุฑุชุจ): ุงุฌุฑุง ูุงูุน dnstt-client ุจุฑุง ูุฑ Resolver (ฺฉโฺฉ)ุ ุจุฑุฑุณ ุงูฺฉู ุชููู ูุงูุนุงู ฺฉุงุฑ ูโฺฉูุฏ ู ุงูุชุฎุงุจ ุจูุชุฑู MTU

ูุฏู ุงู ูพุฑูฺู ูพุฏุง ฺฉุฑุฏู Resolverูุง ุงุณุช ฺฉู **ุฏุฑ ุนูู** ุจุฑุง DNSTT ุฌูุงุจ ูโุฏููุฏุ  
ูุดุงุจู Resolverูุง ฺฉู ุฏุฑ ุงุจุฒุงุฑูุง ูุงูุน ูุซู **HTTP Injector** ุงุณุชูุงุฏู ูโุดููุฏุ  
ูู ุตุฑูุงู Resolverูุง ฺฉู ุจู ฺฉ DNS ุณุงุฏู ุฌูุงุจ ูโุฏููุฏ.

---

## ูพุดโูุงุฒูุง

ูุฑุถ ุจุฑ ุงู ุงุณุช ฺฉู ููุงุฑุฏ ุฒุฑ ุฑุง ุงุฒ ูุจู ูุตุจ ฺฉุฑุฏูโุงุฏ:

- Python ูุณุฎู 3.9 ุง ุจุงูุงุชุฑ  
  https://www.python.org/downloads/

- ฺฉูุงูุช ุฑุณู DNSTT (dnstt-client)  
  https://dnstt.network/

ูุงุจุณุชฺฏโูุง ูพุงุชูู (ฺฉโุจุงุฑ ูุตุจ ูโุดูุฏ):
```bash
pip install dnspython
```
ุงุฎุชุงุฑุ ุจุฑุง ุฎุฑูุฌ Excel ูุงูุน:
```bash
pip install openpyxl
```
---

## ูุฑูุฏ

### ูุณุช DNS Resolverูุง

ุงู ุงุจุฒุงุฑ ฺฉ ูุงู ูุชู ุณุงุฏู ูโฺฏุฑุฏ ฺฉู ุฏุฑ ูุฑ ุฎุท ุขู ฺฉ DNS Resolver ููุดุชู ุดุฏู ุงุณุช.

ุฏุฑ ุงู ุฑูพุงุฒุชูุฑ ฺฉ ูุงู ููููู ูู ูุฌูุฏ ุฏุงุฑุฏ:
```text
sample_dns_list.txt
```
ูโุชูุงูุฏ ุงุฒ ููู ูุงู ุงุณุชูุงุฏู ฺฉูุฏ ุง ุขู ุฑุง ูุฑุงุด ฺฉูุฏ ู DNS ุณุฑูุฑูุง ุฏูุฎูุงู ุฎูุฏุชุงู ุฑุง ุจู ุขู ุงุถุงูู ุง ฺฉู ฺฉูุฏ.

ููุงูู ูุงู:
- ููุท IPv4
- ูุฌูุฏ ยซ:53ยป ูุฌุงุฒ ุงุณุช ูู ูุงุฏุฏู ฺฏุฑูุชู ูโุดูุฏ (ูพูุฑุช ููุดู 53 ุงุณุช)
- ุฎุทูุท ุฎุงู ู ฺฉุงููุชโูุง (#) ูุงุฏุฏู ฺฏุฑูุชู ูโุดููุฏ

---

## Quickstart

ุงฺฏุฑ Python ู dnstt-client ุฑุง ูุตุจ ฺฉุฑุฏูโุงุฏุ ููู ุจุฎุด ุจุฑุง ุดุฑูุน ฺฉุงู ุงุณุช.

ููุท FAST (ููุชุฑ ุณุฑุน):
```bash
python3 dnstt_resolver_probe.py --dns-list sample_dns_list.txt --tunnel-domain t.example.com --out results_fast.csv
```
ุงู ุฏุณุชูุฑ
:
- ุฑุฒุงููุฑูุง ฺฉู ุฒูุฏู ูุณุชูุฏ ุฑุง ูพุฏุง ูฺฉูุฏ
- ุฑุฒุงููุฑูุง ฺฉู ููุงุณุจ ฺฉูุฆุฑโูุง DNSTT ูุณุชูุฏ ุฑุง ุดูุงุณุง ูฺฉูุฏ
- ุณุงุฒูุง payload ฺฉู ุงุญุชูุงูุงู ฺฉุงุฑ ูโฺฉููุฏ ุฑุง ูุดุฎุต ูโฺฉูุฏ

ูโุชูุงูุฏ ูุงู sample_dns_list.txt ุฑุง ุขุฒุงุฏุงูู ูุฑุงุด ฺฉูุฏ ู DNSูุง ุจุดุชุฑ ุจู ุขู ุงุถุงูู ฺฉูุฏ.

ูฺฉุชู:  
ุงฺฏุฑ ูพุงุฑุงูุชุฑ `--tunnel-domain` ุฏุงุฏู ูุดูุฏุ ุงุจุฒุงุฑ ุจูโุตูุฑุช ุฎูุฏฺฉุงุฑ ุฏุฑ ุญุงูุช **FAST-LITE** ุงุฌุฑุง ูโุดูุฏ  
(ููุท ุจุฑุฑุณ ุฒูุฏู ุจูุฏู DNS ู ุฑูุชุงุฑ NXDOMAIN).

ุงฺฏุฑ **public key ุณุฑูุฑุ ุชูุธูุงุช ุฏูู DNSTT ุง ุฌุฒุฆุงุช tunnel-domain** ุฑุง ููโุฏุงูุฏุ FAST mode ุจูุชุฑู ุงูุชุฎุงุจ ุงุณุช.  
ุงู ุญุงูุช ุจุง ุญุฏุงูู ุงุทูุงุนุงุช ูู ูุชุฌูู ฺฉุงุฑุจุฑุฏ ูโุฏูุฏ.

ุญุงูุช FAST + DEEP (ููุงุณุจ ฺฉุงุฑุจุฑุงู ููโุชุฑ):

```bash
python3 dnstt_resolver_probe.py --dns-list sample_dns_list.txt --tunnel-domain t.example.com --run-deep --dnstt-client-path /path/to/dnstt-client --dnstt-pubkey-file /path/to/server.pub --dnstt-mode ssh
```

<img width="2475" height="581" alt="image" src="https://github.com/user-attachments/assets/7cdd4399-7a2d-4682-b7ed-3c8f71dc6729" />


ุงู ุญุงูุช ุนูุงูู ุจุฑ FAST:
- ฺฉ ุชููู DNSTT ูุงูุน ุจุฑุง ูุฑ Resolver ุงุฌุฑุง ูโฺฉูุฏ
- ุจุฑุฑุณ ูโฺฉูุฏ endpoint ูุญู ูุงูุนุงู ูุงุจู ุงุณุชูุงุฏู ุงุณุช
- ุจูุชุฑู MTU ุฑุง ุจุฑ ุงุณุงุณ ุนููฺฉุฑุฏ ูุงูุน ุงูุชุฎุงุจ ูโฺฉูุฏ

ููุฏ DEEP ุจุดุชุฑ ููุงุณุจ ฺฉุณุงู ุงุณุช ฺฉู ุชูุธูุงุช ุณุฑูุฑ (ูุซู public key ู tunnel-domain) ุฑุง ูโุดูุงุณูุฏ.  
ุงู ุญุงูุช ุชุณุช **ุจุณุงุฑ ุฏูู end-to-end** ุงูุฌุงู ูโุฏูุฏ.

ูุงุฒ DEEP ุจูโุตูุฑุช ุชุฑุชุจ ุงุฌุฑุง ูโุดูุฏ.

---

## ููุงูู ููู (ุฎูุงุตู)
### tunnel-domain:
ุฏุงูููโุง ุงุณุช ฺฉู DNSTT ุงุฒ ุขู ุจุฑุง ุงุฑุณุงู ุฏุฑุฎูุงุณุชโูุง DNS ุงุณุชูุงุฏู ูโฺฉูุฏ (ูุซูุงู t.example.com).

- ุงฺฏุฑ ุจุฏุงูุฏ ุฏููุงู ฺุณุช ู ุฏุฑุณุช ุชูุธูุด ฺฉูุฏุ ูุชุฌู **ุฏููโุชุฑ** ูโุดูุฏ
- ุงฺฏุฑ ูุฏุงูุฏุ ูุดฺฉู ูุณุชุ FAST mode ููฺูุงู ฺฉุงุฑ ูโฺฉูุฏ
- ุจุณุงุฑ ุงุฒ ฺฉุงุฑุจุฑุงู ุงู ููุฏุงุฑ ุฑุง ุงุฒ ฺฉ ฺฉุงููฺฏ ุขูุงุฏู ฺฉูพ ูโฺฉููุฏ

ุงฺฏุฑ `--tunnel-domain` ุฏุงุฏู ูุดูุฏุ ุงุจุฒุงุฑ ุฏุฑ ุญุงูุช FAST-LITE ุงุฌุฑุง ูโุดูุฏ.

### MTU (ุณุงุฒ payload):

ุจู ุฒุจุงู ุณุงุฏูุ MTU ุนู **ุจุฒุฑฺฏโุชุฑู ุณุงุฒ DNS ฺฉู ุจุฏูู ุฎุฑุงุจ ุดุฏู ฺฉุงุฑ ูโฺฉูุฏ**.

- ุฎู ฺฉูฺฺฉ = ุณุฑุนุช ฺฉู
- ุฎู ุจุฒุฑฺฏ = ูุทุน ุดุฏู ุง ุฎุฑุงุจ ุดุฏู ูพุงุณุฎ

ุจุฑุง ฺฉุงุฑุจุฑุงู ุนุงุฏ ฺฉู ููุท ูุตุฑูโฺฉููุฏู ูุณุชูุฏุ MTU ููุถูุน ููู ูุณุช ู ูุงุฒู ูุณุช ุฏุฑฺฏุฑุด ุดููุฏ.  
ุงุจุฒุงุฑ ุจูโุตูุฑุช ุฎูุฏฺฉุงุฑ ฺฉ ููุฏุงุฑ ููุงุณุจ ุงูุชุฎุงุจ ูโฺฉูุฏ.

ุชูุธู MTU ุจู ุฏุฑุฏ ฺฉุณุงู ูโุฎูุฑุฏ ฺฉู:
- ุณุฑูุฑ DNSTT ุฑุงูโุงูุฏุงุฒ ูโฺฉููุฏ
- ุง ูโุฎูุงููุฏ ุชูุธูุงุช ุณุฑูุฑ ุฑุง ุฏููโุชุฑ ู ุจูููโุชุฑ ฺฉููุฏ

---

## FAST Mode (ููุท DNS)

ุฏุฑ FAST ูฺ ุชููู ุงุฌุฑุง ููโุดูุฏ ู ูููโฺุฒ ุจูโุตูุฑุช ููุงุฒ ุงูุฌุงู ูโุดูุฏ.

ุจุฑุฑุณโูุง ุดุงูู:
- ูพุงุณุฎโุฏู Resolver
- ูุดุงููโูุง hijack ุง wildcard
- ูพุงุฏุงุฑ payload ุจุฑุง ุฏุงูููู ุชููู
- ุจุฑุฑุณ NS ุฏุงููู (ุจุดุชุฑ ุจุฑุง ุฏุจุงฺฏ)

ุจูโุตูุฑุช ูพุดโูุฑุถุ ูุฑ ุฏู ูุถุนุช ุฒุฑ ูููู ูุญุณูุจ ูโุดููุฏ:
- NOERROR
- NXDOMAIN

### FAST-LITE mode (ุจุฏูู tunnel-domain)

ุงฺฏุฑ `--tunnel-domain` ุฏุงุฏู ูุดูุฏุ ุงุจุฒุงุฑ ุจูโุตูุฑุช ุฎูุฏฺฉุงุฑ ุฏุฑ ุญุงูุช **FAST-LITE** ุงุฌุฑุง ูโุดูุฏ.

ุฏุฑ ุงู ุญุงูุช ููุท ููุงุฑุฏ ุฒุฑ ุจุฑุฑุณ ูโุดููุฏ:
- ุฒูุฏู ุจูุฏู DNS Resolver
- ุฑูุชุงุฑ NXDOMAIN (ุจุฑุง ุชุดุฎุต hijack ุง wildcard)

ููุงุฑุฏ ุฒุฑ ุฏุฑ FAST-LITE ุงุฌุฑุง **ููโุดููุฏ**:
- ุชุณุช payload ุจุฑุง ุฏุงูููู ุชููู
- ุชุดุฎุต MTU
- ุจุฑุฑุณ Zone / NS

ุญุงูุช FAST-LITE ููุท ุจุฑุง **ุบุฑุจุงู ุงููู** ููุงุณุจ ุงุณุช  
ู ุณุงุฒฺฏุงุฑ ูุงูุน Resolver ุจุง DNSTT ุฑุง ุชุฃุฏ ููโฺฉูุฏ.

---

## DEEP Mode (ุชููู ูุงูุน)

ุฏุฑ DEEP ุจุฑุง ูุฑ Resolver ฺฉ ุชููู ูุงูุน DNSTT ุงุฌุฑุง ูโุดูุฏ.

Deep-1:
- ุฏุฑ ุญุงูุช SSH ููุชุธุฑ banner ูุงูุน SSH ูโูุงูุฏ
- ุฏุฑ ุญุงูุช SOCKSุ handshake ู ุงุชุตุงู TCP ุจุฑุฑุณ ูโุดูุฏ

Deep-2:
- ุชุณุช ุฏูุจุงุฑูู ุณุงุฒูุง payload
- ุงูุชุฎุงุจ ุจูุชุฑู MTU ุจุฑ ุงุณุงุณ ูุฑุฎ ููููุชุ timeoutุ TCP fallback ู latency

ุงฺฏุฑ Deep-1 ุดฺฉุณุช ุจุฎูุฑุฏุ Deep-2 ุงุฌุฑุง ููโุดูุฏ.

ุจุฑุง ุงุฌุฑุง DEEPุ ูุฌูุฏ `--tunnel-domain` ุงูุฒุงู ุงุณุช ู  
ุงู ูุงุฒ ุฏุฑ ุญุงูุช FAST-LITE ูุงุจู ุงุฌุฑุง ูุณุช.

---

## ูุงฺฏโูุง

ูุงฺฏโูุง dnstt-client ุจุฑุง ูุฑ Resolver ุฏุฑ ูุงู ุฌุฏุง ุฐุฎุฑู ูโุดููุฏ:
```text
results/dnstt_<resolver>_<port>.log
```
ูุงฺฏโูุง ุฏุฑ ุชุฑููุงู ฺุงูพ ููโุดููุฏ.  
ุฏุฑ ุนูุถุ ูุณุฑ ูุงฺฏ ู ุจุฎุด ุงูุชูุง ุขู ุฏุฑ ูุงู ุฎุฑูุฌ ุฐุฎุฑู ูโุดูุฏ ุชุง ุจุชูุงูุฏ ุจุฑุฑุณ ฺฉูุฏ.

---

## ูุงู ุฎุฑูุฌ

ุฏุฑ ูุฑ ุงุฌุฑุง ุฏููุงู **ฺฉ ูุงู ุฎุฑูุฌ** ุฏุงุฑุฏ:
- CSV ุจูโุตูุฑุช ูพุดโูุฑุถ
- XLSX ุฏุฑ ุตูุฑุช ุงุณุชูุงุฏู ุงุฒ ฺฏุฒูู `--xlsx`

<img width="2421" height="1315" alt="image" src="https://github.com/user-attachments/assets/a0dfc3ef-ea23-4e01-960d-2c22d2303f05" />

ุฏุฑ ุญุงูุช FAST-LITEุ ููุฏุงุฑ ุณุชูู `recommendation` ุจุฑุงุจุฑ ุจุง `UNKNOWN` ุฎูุงูุฏ ุจูุฏุ  
ุจู ุงู ูุนู ฺฉู ุณุงุฒฺฏุงุฑ DNSTT ุจูโุตูุฑุช ฺฉุงูู ุจุฑุฑุณ ูุดุฏู ุงุณุช.

---

## ุงูู ู ูุฌูุฒ ุงุณุชูุงุฏู

ุงุฒ ุงู ุงุจุฒุงุฑ ููุท ุฑู DNS Resolverูุง ุงุณุชูุงุฏู ฺฉูุฏ ฺฉู ูุงูฺฉ ุขูโูุง ูุณุชุฏ  
ุง ุงุฌุงุฒูู ุตุฑุญ ุจุฑุง ุชุณุช ุขูโูุง ุฏุงุฑุฏ.

FAST ููุท DNS query ุงุฑุณุงู ูโฺฉูุฏ.  
DEEP ฺฉ ุชููู DNSTT ูุงูุน ุงุฌุฑุง ูโฺฉูุฏ.
